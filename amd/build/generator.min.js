define("block_course_generator/generator",["jquery","core/templates","core/notification","core/str"],(function($,Template,Notification,Str){const generatorForm=document.getElementById("edai_course_generator_form"),promptContainer=generatorForm.querySelector(".prompt-container"),promptForm=generatorForm.querySelector("#prompt-form"),carousel=generatorForm.querySelector("#carousel-controls"),generationContainer=generatorForm.querySelector(".generation-container"),courseDescription=generatorForm.querySelector("#course_description"),generateCourse=generatorForm.querySelector("#generate_course"),tempCourseFiles=generatorForm.querySelector("#temp_course_files"),courseFiles=generatorForm.querySelector("#course_files"),filesContainer=generatorForm.querySelector("#file_names"),spinner=generatorForm.querySelector("#progress-spinner");return{init:function(){this.progress=0,this.adjustDescriptionHeight(),this.handleDragAndDrop(),generateCourse.addEventListener("click",(event=>{event.preventDefault(),""!==courseDescription.value.trim()||0!==courseFiles.files.length?(0===this.progress&&this.startProgress(),setTimeout((()=>{this.finishProgress(2)}),5e3)):this.notify("invalidinput","descriptionorfilesrequired")}))},adjustDescriptionHeight:function(){const initialheight=courseDescription.clientHeight;courseDescription.addEventListener("input",(function(){const lineheight=parseFloat(getComputedStyle(courseDescription).lineHeight),lines=courseDescription.value.split("\n").length;let newheight;lines*lineheight<initialheight?newheight=initialheight:lines<=9?(newheight=lines*lineheight,courseDescription.style.overflowY="hidden"):(newheight=9*lineheight,courseDescription.style.overflowY="scroll"),newheight+=newheight>initialheight?14:0,courseDescription.style.height=newheight+"px"}))},clearAllFiles:function(){let dataTransfer=new DataTransfer;courseFiles.files=dataTransfer.files,this.displayFileNames()},transferFiles:function(newFiles){const allowedtypes=["application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf","text/plain"];let totalSize=0,existingFiles=Array.from(courseFiles.files);for(let file of existingFiles)totalSize+=file.size;for(let file of newFiles){if(!allowedtypes.includes(file.type))return void this.notify("uploaderror",["filetypeinvalid",file.name]);if(totalSize+=file.size,file.size>20971520)return void this.notify("uploaderror",["filetoolarge",file.name]);if(totalSize>52428800)return void this.notify("uploaderror","totaltoolarge")}for(let file of newFiles)existingFiles.some((existingFile=>existingFile.name===file.name&&existingFile.size===file.size))||existingFiles.push(file);let dataTransfer=new DataTransfer;for(let file of existingFiles)dataTransfer.items.add(file);courseFiles.files=dataTransfer.files,this.displayFileNames()},handleDragAndDrop:function(){let dragEnterCounter=0;$("#prompt-form").bind({dragenter:function(event){event.preventDefault(),event.stopPropagation(),dragEnterCounter++,promptContainer.classList.add("drag-over")},dragleave:function(event){event.preventDefault(),event.stopPropagation(),dragEnterCounter--,0===dragEnterCounter&&promptContainer.classList.remove("drag-over")}}),this.dropOnChildElements(promptForm),tempCourseFiles.addEventListener("change",(()=>{let newFiles=Array.from(tempCourseFiles.files);this.transferFiles(newFiles)}))},dropOnChildElements:function(node){node.childNodes.forEach((child=>{this.dropOnChildElements(child),child.addEventListener("dragover",(event=>{event.preventDefault(),event.stopPropagation()})),child.addEventListener("drop",(event=>{event.preventDefault(),event.stopPropagation(),promptContainer.classList.remove("drag-over"),event.dataTransfer.files.length>0&&this.transferFiles(event.dataTransfer.files)}))}))},startProgress:function(){generateCourse.disabled=!0,spinner.classList.add("spinner-border"),promptContainer.classList.replace("d-block","d-none"),generationContainer.classList.replace("d-none","d-block");let interval=setInterval((()=>{this.progress>=90&&clearInterval(interval);let increment=Math.floor(5*Math.random());this.setProgress(this.progress+increment)}),1e3)},finishProgress:async function(courseid){spinner.classList.remove("spinner-border"),Template.render("block_course_generator/success_message",{courseid:courseid}).then((html=>{generationContainer.innerHTML+=html;let resetLink=generatorForm.querySelector(".reset-prompt");resetLink&&resetLink.addEventListener("click",(()=>{this.resetProgress()}))})).catch((error=>{Notification.exception(error)})),this.setProgress(100)},resetProgress:function(){generateCourse.disabled=!1,spinner.classList.remove("spinner-border"),promptContainer.classList.replace("d-none","d-block"),generationContainer.classList.replace("d-block","d-none"),courseDescription.value="";let successContainer=generatorForm.querySelector("#success_message_container");successContainer&&successContainer.remove(),this.clearAllFiles(),this.setProgress(0)},setProgress:function(progress){this.progress=progress;let progressBar=generatorForm.querySelector(".s-progress--bar");progressBar.style.width="".concat(progress,"%"),progress>=100?progressBar.classList.add("done"):progressBar.classList.remove("done")},displayFileNames:function(){let contextFiles=[],totalSize=0;for(let i=0;i<courseFiles.files.length;i++){const file=courseFiles.files[i];totalSize+=file.size,contextFiles.push({name:file.name,size:this.formatFilesize(file.size)})}let hasFiles=contextFiles.length>0,context={hasFiles:hasFiles,totalSize:this.formatFilesize(totalSize),files:contextFiles};hasFiles?carousel.classList.add("d-none"):carousel.classList.remove("d-none"),Template.render("block_course_generator/filenames",context).then((html=>{filesContainer.innerHTML=html,filesContainer.querySelectorAll(".delete-icon").forEach(((deleteIcon,index)=>{let that=this,toDelete=courseFiles.files[index].name;deleteIcon.addEventListener("click",(function(){let toolTipId=deleteIcon.getAttribute("aria-describedby");document.getElementById(toolTipId).remove();let dataTransfer=new DataTransfer;for(let i=0;i<courseFiles.files.length;i++)courseFiles.files[i].name!==toDelete&&dataTransfer.items.add(courseFiles.files[i]);courseFiles.files=dataTransfer.files,that.displayFileNames()}))}))})).catch((error=>{Notification.exception(error)}))},formatFilesize:size=>{const units=["bytes","KB","MB","GB","TB"];let unitIndex=0;for(;size>=1024&&unitIndex<units.length-1;)size/=1024,unitIndex++;return"".concat(size.toFixed(1)," ").concat(units[unitIndex])},notify:async function(){let strings=[];for(let i=0;i<arguments.length;i++)Array.isArray(arguments[i])?strings.push({key:arguments[i][0],component:"block_course_generator",param:arguments[i][1]}):strings.push({key:arguments[i],component:"block_course_generator"});Str.get_strings(strings).done((s=>{s.length>1?Notification.alert(s[0],s[1]):Notification.alert("",s[0])})).fail(Notification.exception)}}}));

//# sourceMappingURL=generator.min.js.map