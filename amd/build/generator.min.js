define(["jquery","core/ajax","core/templates"],(function(e,r,t){const s=document.getElementById("edai_course_generator_form"),n=s.querySelector(".prompt-container"),o=s.querySelector("#prompt-form"),l=s.querySelector(".generation-container"),i=s.querySelector("#course_description"),a=s.querySelector("#generate_course"),c=s.querySelector("#temp_course_files"),d=s.querySelector("#course_files"),f=s.querySelector("#file_names"),p=s.querySelector("#progress-spinner"),u=s.querySelector("#loader"),g=s.querySelector("#success_message_container");return{init:function(){this.progress=0;const r=i.clientHeight;i.addEventListener("input",(function(){const e=parseFloat(getComputedStyle(i).lineHeight),t=i.value.split("\n").length;let s;t*e<r?s=r:t<=9?(s=t*e,i.style.overflowY="hidden"):(s=9*e,i.style.overflowY="scroll"),s+=s>r?14:0,i.style.height=s+"px"})),a.addEventListener("click",(e=>{e.preventDefault(),u.classList.replace("d-none","d-block"),0===this.progress?(this.startProgress(u),p.classList.add("spinner-border"),l.classList.replace("d-none","d-block")):this.progress<100?(this.setProgress(u,100),g.classList.replace("d-none","d-block"),p.classList.remove("spinner-border")):(this.setProgress(u,0),g.classList.replace("d-block","d-none"),p.classList.remove("spinner-border"),l.classList.replace("d-block","d-none"))})),dragEnterCounter=0,e("#prompt-form").bind({dragenter:function(e){e.preventDefault(),e.stopPropagation(),dragEnterCounter++,n.classList.add("drag-over")},dragleave:function(e){e.preventDefault(),e.stopPropagation(),dragEnterCounter--,0===dragEnterCounter&&n.classList.remove("drag-over")}}),this.dropOnChildElements(o),c.addEventListener("change",(()=>{let e=Array.from(c.files);this.transferFiles(e)}))},transferFiles:function(e){let r=Array.from(d.files);for(let t of e)r.some((e=>e.name===t.name&&e.size===t.size))||r.push(t);let t=new DataTransfer;for(let e of r)t.items.add(e);d.files=t.files,this.displayFileNames()},dropOnChildElements:function(e){e.childNodes.forEach((e=>{this.dropOnChildElements(e),e.addEventListener("dragover",(e=>{e.preventDefault(),e.stopPropagation()})),e.addEventListener("drop",(e=>{e.preventDefault(),e.stopPropagation(),n.classList.remove("drag-over"),e.dataTransfer.files.length>0&&this.transferFiles(e.dataTransfer.files)}))}))},startProgress:function(e){let r=setInterval((()=>{this.progress>=90&&clearInterval(r);let t=Math.floor(5*Math.random());this.setProgress(e,this.progress+t)}),1e3)},setProgress:function(e,r){let t=e.querySelector(".s-progress--bar");t.style.width=`${r}%`,r>=100?t.classList.add("done"):t.classList.remove("done"),this.progress=r},displayFileNames:function(){const e=e=>{const r=["bytes","KB","MB","GB","TB"];let t=0;for(;e>=1024&&t<r.length-1;)e/=1024,t++;return`${e.toFixed(1)} ${r[t]}`};let r=[];for(let t=0;t<d.files.length;t++){const s=d.files[t];r.push({name:s.name,size:e(s.size)})}let s=r.length>0;t.render("block_course_generator/filenames",{hasFiles:s,files:r}).then((e=>{f.innerHTML=e,f.querySelectorAll(".delete-icon").forEach(((e,r)=>{let t=d.files[r].name;e.addEventListener("click",(function(){let e=new DataTransfer;for(let r=0;r<d.files.length;r++)d.files[r].name!==t&&e.items.add(d.files[r]);d.files=e.files,this.closest("li").remove()}))}))})).catch((e=>{console.error("Error rendering template: ",e)}))}}}));